<div class="awesome-table-component">
    <style>
        .awesome-table-component {
            font-family: 'JetBrains Mono', 'Roboto Mono', 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .table-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .table-controls input,
        .table-controls select {
            padding: 8px 12px;
            border: 1px solid #d1d5da;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        .table-controls input {
            flex: 1;
            min-width: 200px;
        }

        .table-controls select {
            min-width: 120px;
        }

        .results-count {
            font-size: 14px;
            color: #666;
            margin-left: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background: #f6f8fa;
        }

        th {
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            color: #24292f;
            border-bottom: 1px solid #d1d5da;
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        th:hover {
            background: #f3f4f6;
        }

        th.sortable {
            padding-right: 30px;
        }

        th.sortable::after {
            content: '↕';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: #666;
            opacity: 0.6;
        }

        th.sort-asc::after {
            content: '↑';
            opacity: 1;
        }

        th.sort-desc::after {
            content: '↓';
            opacity: 1;
        }

        td {
            padding: 12px 16px;
            border-bottom: 1px solid #d1d5da;
            vertical-align: top;
        }

        tbody tr:hover {
            background: #f6f8fa;
        }

        .project-name {
            font-weight: 600;
            color: #0366d6;
            text-decoration: none;
            display: block;
            margin-bottom: 4px;
        }

        .project-name:hover {
            text-decoration: underline;
        }

        .project-link {
            color: #656d76;
            font-size: 12px;
            text-decoration: none;
            display: block;
        }

        .project-link:hover {
            text-decoration: underline;
        }

        .stars {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: #24292f;
            font-weight: 600;
            font-size: 14px;
        }

        .stars::before {
            content: '⭐';
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .tag {
            background: #f1f8ff;
            color: #0366d6;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid #c7e4f7;
        }

        .description {
            color: #24292f;
            line-height: 1.5;
            max-width: 400px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .awesome-table-component {
                padding: 10px;
            }

            .table-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .table-controls input {
                min-width: auto;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 8px 12px;
            }

            .description {
                max-width: 200px;
            }
        }
    </style>

    <div class="table-controls">
        <input type="text" id="search-input" placeholder="Поиск по названию, описанию или тегам..." autocomplete="off">
        <select id="category-filter">
            <option value="">Все категории</option>
        </select>
        <select id="language-filter">
            <option value="">Все языки</option>
        </select>
        <div class="results-count" id="results-count"></div>
    </div>

    <table id="projects-table">
        <thead>
            <tr>
                <th class="sortable" data-sort="name">Название</th>
                <th class="sortable" data-sort="stars">⭐ Звёзды</th>
                <th class="sortable" data-sort="language">Язык</th>
                <th>Описание</th>
                <th>Теги</th>
            </tr>
        </thead>
        <tbody id="table-body">
            {{- define "CategoryItems" -}}
            {{- range . }}
                {{- $categoryTitle := .Title -}}
                {{ if .Items -}}
                {{- range .Items }}
                <tr data-category="{{ $categoryTitle }}" data-language="{{ .Language }}" data-name="{{ .Name }}" data-description="{{ .Summary }}" data-tags="{{ .Tags }}">
                    <td>
                        <a href="{{ .Link }}" class="project-name" target="_blank" rel="noopener">{{ .Name }}</a>
                        <a href="{{ .Link }}" class="project-link" target="_blank" rel="noopener">{{ .Link }}</a>
                    </td>
                    <td>
                        <span class="stars">{{ .Stars }}</span>
                    </td>
                    <td>{{ if .Language }}{{ .Language }}{{ else }}-{{ end }}</td>
                    <td>
                        <div class="description">{{ .Summary }}</div>
                    </td>
                    <td>
                        <div class="tags">
                            {{- if .Tags -}}
                            {{- range (splitList ", " .Tags) }}
                            <span class="tag">{{ . }}</span>
                            {{- end -}}
                            {{- end }}
                        </div>
                    </td>
                </tr>
                {{- end }}
                {{- end }}
                {{ if .Categories -}}
                {{ template "CategoryItems" .Categories }}
                {{- end -}}
            {{ end -}}
            {{- end -}}
            {{ template "CategoryItems" .Categories }}
        </tbody>
    </table>

    <script>
        class AwesomeTableComponent {
            constructor() {
                this.table = document.getElementById('projects-table');
                this.tableBody = document.getElementById('table-body');
                this.searchInput = document.getElementById('search-input');
                this.categoryFilter = document.getElementById('category-filter');
                this.languageFilter = document.getElementById('language-filter');
                this.resultsCount = document.getElementById('results-count');
                this.rows = Array.from(this.tableBody.querySelectorAll('tr'));
                this.currentSort = { column: null, direction: null };

                this.init();
            }

            init() {
                // Populate filters
                this.populateFilters();

                // Add event listeners
                this.searchInput.addEventListener('input', () => this.filterAndSort());
                this.categoryFilter.addEventListener('change', () => this.filterAndSort());
                this.languageFilter.addEventListener('change', () => this.filterAndSort());

                // Add sorting to headers
                this.table.querySelectorAll('th.sortable').forEach(th => {
                    th.addEventListener('click', () => this.sort(th.dataset.sort));
                });

                // Initial render
                this.filterAndSort();
            }

            populateFilters() {
                const categories = new Set();
                const languages = new Set();

                this.rows.forEach(row => {
                    const category = row.dataset.category;
                    const language = row.dataset.language;

                    if (category) categories.add(category);
                    if (language) languages.add(language);
                });

                // Populate category filter
                Array.from(categories).sort().forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    this.categoryFilter.appendChild(option);
                });

                // Populate language filter
                Array.from(languages).sort().forEach(language => {
                    const option = document.createElement('option');
                    option.value = language;
                    option.textContent = language;
                    this.languageFilter.appendChild(option);
                });
            }

            filterAndSort() {
                const searchTerm = this.searchInput.value.toLowerCase().trim();
                const selectedCategory = this.categoryFilter.value;
                const selectedLanguage = this.languageFilter.value;

                let filteredRows = this.rows.filter(row => {
                    const matchesSearch =
                        !searchTerm ||
                        row.dataset.name.toLowerCase().includes(searchTerm) ||
                        row.dataset.description.toLowerCase().includes(searchTerm) ||
                        row.dataset.tags.toLowerCase().includes(searchTerm);

                    const matchesCategory = !selectedCategory || row.dataset.category === selectedCategory;
                    const matchesLanguage = !selectedLanguage || row.dataset.language === selectedLanguage;

                    return matchesSearch && matchesCategory && matchesLanguage;
                });

                // Apply sorting
                if (this.currentSort.column) {
                    filteredRows.sort((a, b) => {
                        let aVal = a.dataset[this.currentSort.column] || '';
                        let bVal = b.dataset[this.currentSort.column] || '';

                        // Convert stars to numbers
                        if (this.currentSort.column === 'stars') {
                            aVal = parseInt(aVal) || 0;
                            bVal = parseInt(bVal) || 0;
                        } else {
                            aVal = aVal.toLowerCase();
                            bVal = bVal.toLowerCase();
                        }

                        if (aVal < bVal) return this.currentSort.direction === 'asc' ? -1 : 1;
                        if (aVal > bVal) return this.currentSort.direction === 'asc' ? 1 : -1;
                        return 0;
                    });
                }

                // Update table
                this.tableBody.innerHTML = '';
                if (filteredRows.length === 0) {
                    this.tableBody.innerHTML = '<tr><td colspan="5" class="no-results">Нет результатов поиска</td></tr>';
                } else {
                    filteredRows.forEach(row => this.tableBody.appendChild(row));
                }

                // Update results count
                this.resultsCount.textContent = `Найдено: ${filteredRows.length} проектов`;
            }

            sort(column) {
                // Reset previous sort indicators
                this.table.querySelectorAll('th').forEach(th => {
                    th.classList.remove('sort-asc', 'sort-desc');
                });

                // Determine new sort direction
                if (this.currentSort.column === column) {
                    this.currentSort.direction = this.currentSort.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    this.currentSort.column = column;
                    this.currentSort.direction = 'asc';
                }

                // Update sort indicator
                const th = this.table.querySelector(`th[data-sort="${column}"]`);
                th.classList.add(`sort-${this.currentSort.direction}`);

                // Re-filter and sort
                this.filterAndSort();
            }
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => new AwesomeTableComponent());
        } else {
            new AwesomeTableComponent();
        }
    </script>
</div>
